#!/usr/bin/env python
import optparse
import os
import sys

import nose

import stacktester.config


def main():
    options, args = parse_options()
    stacktester.config.StackConfig._path = os.path.abspath(options.config)
    nose_argv = [sys.argv[0]]

    if options.verbose:
        nose_argv.append("-v")

    nose_argv.extend(args)
    nose.main(module="stacktester", 
              argv=nose_argv, 
              defaultTest="stacktester.tests")


def parse_options():
    parser = optparse.OptionParser()
    parser.add_option("-c", 
                      "--config", 
                      dest="config", 
                      metavar="FILE",
                      help="Load configuration from FILE.",
                      default="etc/stacktester.cfg")
    parser.add_option("-v",
                      "--verbose",
                      dest="verbose",
                      action="store_true",
                      help="Toggle verbose output.")
    return parser.parse_args()


if __name__ == "__main__":
    sys.exit(main())
